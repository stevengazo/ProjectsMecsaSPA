@page "/projects"

<Toasts class="p-3" Messages="messages" Placement="ToastsPlacement.TopRight" />
<Offcanvas @ref="offcanvas" />



<div class="d-flex flex-row justify-content-between">
    <h3>Proyectos</h3>
    <AuthorizeView Roles="administrador,ingeniero">
        <Authorized>
            <Tooltip Class="d-inline-block" Title="Agregar un nuevo proyecto" role="button">
                <button class="btn btn-sm btn-outline-success" @onclick="ShowEmployeeComponent">
                    <Icon Name="IconName.DatabaseFillAdd" />Proyecto
                </button>
            </Tooltip>
        </Authorized>
    </AuthorizeView>


</div>
<div class="mt-3 bg-success text-white bg-opacity-75">
    @message
</div>

<AuthorizeView Roles="administrador,ingeniero,asistente ,contabilidad,vendedor">
    <Authorized>
        <div class="mb-2 p-2">
            <Tabs EnableFadeEffect="true">
                <Tab Title="Búsqueda" Active="true">
                    <Content>
                        <div class="p-1">
                            <SearchProjectsComponent />
                        </div>
                    </Content>
                </Tab>
                <Tab Title="General">
                    <Content>
                        <div class="p-1">
                            <PaginationProjectsComponents />
                        </div>
                    </Content>
                </Tab>
                <Tab Title="Ventas">
                    <Content>
                        <div class="p-1">
                            <SalesList />
                        </div>
                    </Content>
                </Tab>
            </Tabs>
        </div>
    </Authorized>
    <NotAuthorized>
        <ErrorViewComponent />
    </NotAuthorized>
</AuthorizeView>





@code {
    private Offcanvas offcanvas = default!;
    private string? message;
    List<ToastMessage> messages = new List<ToastMessage>();



    private async Task ShowEmployeeComponent()
    {
        // Crear un diccionario para pasar parámetros al componente AddProject
        var parameters = new Dictionary<string, object>
        {
            // Usar EventCallback.Factory.Create para crear un EventCallback para el método HandleProjectAdded
            { nameof(AddProject.OnAdded), EventCallback.Factory.Create(this, HandleProjectAdded) }
        };

        // Mostrar el componente AddProject dentro del Offcanvas
        // El primer parámetro es el título del Offcanvas
        // El segundo parámetro es el diccionario de parámetros que contiene el EventCallback
        await offcanvas.ShowAsync<AddProject>("Agregar Proyecto", parameters);
    }

    private async Task HandleProjectAdded()
    {


        await offcanvas.HideAsync();
        messages.Add(new()
        {
            Message = "Proyecto Agregado",
            Type = ToastType.Success
        });
    }
}
