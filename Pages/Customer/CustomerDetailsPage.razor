@page "/customers/{id}"

@inject IDbContextFactory<ProjectsDBContext> DbContextFactory

<h3>Información del Cliente</h3>
<DetailsCustomerComponent  customer="customer" />

<table class="table table-striped">
    <thead>
        <tr>
            <th>N</th>
            <th>Titulo</th>
            <th>Cliente</th>
            <th>Estado</th>
            <th>OC</th>
            <th>Tipo</th>
            <th>Creación</th>
            <th>Monto</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var project in customer.Projects)
        {
            <RowTableComponent ProjectObj="project" />
        }
    </tbody>
</table>

@code {
    [Parameter]
    public string id { get; set; }
    private Customer customer = new();

    protected override async Task OnInitializedAsync()
    {

        base.OnInitializedAsync();
        int.TryParse(id, out int customerid);
        using (var db = DbContextFactory.CreateDbContext())
        {
            customer = db.Customers
            .Include(i=>i.Projects) 
            .ThenInclude(i=>i.State)
            .FirstOrDefault(w => w.CustomerId == customerid);
        }
    }
}
