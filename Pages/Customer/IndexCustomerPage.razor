@page "/customers"

<Toasts class="p-3" Messages="messages" Placement="ToastsPlacement.TopRight" />


<div class="d-flex flex-row justify-content-between">
    <h3>Clientes</h3>
    <AuthorizeView Roles="administrador,ingeniero,contabilidad,vendedor">
        <Authorized>
            <button class="btn btn-outline-success" @onclick="ShowAddCustomer">Crear Cliente</button>
        </Authorized>
        <NotAuthorized>
        </NotAuthorized>
    </AuthorizeView>
  
</div>

<div class="mt-3 bg-success text-white bg-opacity-75">
    @message
</div>
<Offcanvas @ref="offcanvas" />


<AuthorizeView Roles="administrador,asistente,ingeniero,contabilidad,vendedor">
    <Authorized >
        <Tabs EnableFadeEffect="true">
            <Tab Title="Buscar" Active="true">
                <Content>
                    <SearchCustomerComponent />
                </Content>
            </Tab>
            <Tab Title="Todos" >
                <Content>
                    <ListCustomerComponent />
                </Content>
            </Tab>
        </Tabs>
 
    </Authorized>
</AuthorizeView>







@code {
    private Offcanvas offcanvas = default!;

    private string? message;
    List<ToastMessage> messages = new List<ToastMessage>();



    private async Task ShowAddCustomer()
    {
        // Crear un diccionario para pasar parámetros al componente AddProject
        var parameters = new Dictionary<string, object>
        {
            // Usar EventCallback.Factory.Create para crear un EventCallback para el método HandleProjectAdded
            { nameof(AddCustomerComponent.OnAdded), EventCallback.Factory.Create(this, HandleProjectAdded) }
        };

        // Mostrar el componente AddProject dentro del Offcanvas
        // El primer parámetro es el título del Offcanvas
        // El segundo parámetro es el diccionario de parámetros que contiene el EventCallback
        await offcanvas.ShowAsync<AddCustomerComponent>("Agregar Cliente ", parameters);
    }

    private async Task HandleProjectAdded()
    {

        await offcanvas.HideAsync();
        messages.Add(new()
            {
                Message = "Cliente Agregado Agregado",
                Type = ToastType.Success
            });

    }

}