@inject ApplicationDbContext dbContext;

<Offcanvas @ref="offcanvas" />
<Toasts class="p-3" Messages="messages" Placement="ToastsPlacement.TopRight" />



<button class="btn btn-outline-success" @onclick="AddUser">
    Agregar
</button>

<table class="table table-striped">
    <thead>
        <tr>
            <th>
                Nombre
            </th>
            <th>
                Cédula
            </th>
            <th>
                Correo
            </th>
            <th>
                Nombre de usuario
            </th>
            <th>
                Estado
            </th>
            <th colspan="3">
                Acciones
            </th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Users)
        {
            <RowUserComponent item="item" />
        }
    </tbody>
</table>




@code {
    List<UserIdentityEx> Users = new();
    private Offcanvas offcanvas = default!;
    private string? message;
    List<ToastMessage> messages = new List<ToastMessage>();


    protected override async Task OnInitializedAsync()
    {

        Users = await dbContext.Users.OrderBy(e=>e.Name).ToListAsync();
        base.OnInitializedAsync();
    }

    private async Task AddUser()
    {
        // Crear un diccionario para pasar parámetros al componente AddProject
        var parameters = new Dictionary<string, object>
        {
            // Usar EventCallback.Factory.Create para crear un EventCallback para el método HandleProjectAdded
            { nameof(AddUserComponent.OnAdded), EventCallback.Factory.Create(this, HandleUserAdded) }
        };

        // Mostrar el componente AddProject dentro del Offcanvas
        // El primer parámetro es el título del Offcanvas
        // El segundo parámetro es el diccionario de parámetros que contiene el EventCallback
        await offcanvas.ShowAsync<AddUserComponent>("Registrar Usuario", parameters);
    }
    private async Task HandleUserAdded()
    {
        Users = await dbContext.Users.OrderBy(e => e.Name).ToListAsync();
          await offcanvas.HideAsync();
            messages.Add(new()
                {
                    Message = "Usuario Agregado",
                    Type = ToastType.Success
                });
        
    }

}

