@inject ProjectsDBContext db

<div class="border rounded shadow-sm p-3 mb-3">

    <h6 class="fw-bold mb-3">Agregar Compañía</h6>

    <EditForm Model="@companyNew">
        <div class="row g-2 align-items-end">

            <div class="col-md-6">
                <div class="form-floating">
                    <InputText id="CompanyName"
                               class="form-control form-control-sm shadow-sm"
                               @bind-Value="companyNew.CompanyName" />
                    <label for="CompanyName">Nombre de la Compañía</label>
                </div>
            </div>

            <div class="col-md-3">
                <button type="button"
                        class="btn btn-sm btn-outline-success w-100"
                        @onclick="AddCompanyAsync">
                    Agregar
                </button>
            </div>

        </div>
    </EditForm>
</div>

<div class="mt-3">
    @foreach (var i in companies)
    {
        <CompanyData Company="@i" />
    }
</div>


@code {
	List<Company> companies = new List<Company>();

	private Company companyNew { get; set; }	

	protected override async Task OnInitializedAsync()
	{
		companyNew = new Company();	
		companies = await db.Company.AsNoTracking().ToListAsync();
	}

	async Task AddCompanyAsync()
	{
		if(!string.IsNullOrEmpty(companyNew.CompanyName))
		{
			db.Company.Add(companyNew);
			db.SaveChanges();
			companies.Add(companyNew);
			companyNew = new Company();
			StateHasChanged();
		}
	}
}
