@inject IDbContextFactory<ProjectsDBContext> DbContextFactory
@inject APICarServices CarServices
<div class="p-3">

    <EditForm Model="newSchedule" OnValidSubmit="HandleValidSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="row gy-3">


            <!-- Inicio -->
            <div class="col-md-6">
                <label class="form-label">Fecha de Inicio</label>
                <InputDate @bind-Value="newSchedule.Start" class="form-control form-control-sm" />
            </div>
            <!-- Fin de Semana -->
            <div class="col-md-6">
                <label class="form-label">Fin de semana</label>
                <InputCheckbox @bind-Value="newSchedule.WeekendWork" class="" />
            </div>

            <!-- Fin -->
            <div class="col-md-6">
                <label class="form-label">Fecha de Fin</label>
                <InputDate @bind-Value="newSchedule.End" class="form-control form-control-sm" />
            </div>


            <!-- Vehículo -->
            <div class="col-12">
                <label class="form-label">Tarea</label>
                <InputText @bind-Value="newSchedule.TaskName" class="form-control form-control-sm" />
            </div>
            <!-- Notas -->
            <div class="col-12">
                <label class="form-label">Notas</label>
                <InputTextArea @bind-Value="newSchedule.Notes"
                               class="form-control form-control-sm"
                               rows="3" />
            </div>

            <!-- Vehículo -->
            <div class="col-12">
                <label class="form-label">Vehículo</label>
                <InputSelect @bind-Value="newSchedule.Car" class="form-select form-select-sm">
                    <option value="">Seleccione un vehículo</option>
                    @foreach (var item in cars)
                    {
                        <option value="@($"{item.Brand} {item.Model} ({item.Plate})")">
                            @item.Brand @item.Model (@item.Plate)
                        </option>
                    }
                </InputSelect>
            </div>

            <!-- Vehículo -->
            <div class="col-12">
                <label class="form-label">Color</label>

                <InputSelect @bind-Value="newSchedule.Color" class="form-select form-select-sm color-select">
                    <option value="">Seleccione un Color</option>

                    <option value="gray" style="background:#808080; color:#fff;">Gris</option>
                    <option value="silver" style="background:#C0C0C0; color:#000;">Plateado</option>

                    <option value="red" style="background:#ff0000; color:#fff;">Rojo</option>
                    <option value="maroon" style="background:#800000; color:#fff;">Burdeos</option>

                    <option value="blue" style="background:#0000ff; color:#fff;">Azul</option>
                    <option value="skyblue" style="background:#87ceeb; color:#000;">Celeste</option>
                    <option value="navy" style="background:#000080; color:#fff;">Azul Marino</option>

                    <option value="green" style="background:#008000; color:#fff;">Verde</option>
                    <option value="lime" style="background:#00ff00; color:#000;">Verde Lima</option>
                    <option value="olive" style="background:#808000; color:#fff;">Oliva</option>

                    <option value="yellow" style="background:#ffff00; color:#000;">Amarillo</option>
                    <option value="gold" style="background:#ffd700; color:#000;">Dorado</option>
                    <option value="orange" style="background:#ffa500; color:#000;">Naranja</option>

                    <option value="brown" style="background:#8b4513; color:#fff;">Café</option>
                    <option value="chocolate" style="background:#d2691e; color:#fff;">Chocolate</option>
                </InputSelect>
            </div>




            <!-- Botón -->
            <div class="col-12 text-end mt-2">
                <button class="btn btn-primary btn-sm px-3">
                    Guardar
                </button>
            </div>

        </div>
    </EditForm>
</div>

@code {
    [Parameter]
    public int ProjectId { get; set; }

    private List<Car> cars = new();
    private ProjectsDBContext _dbContext;

    private Schedule newSchedule = new()
    {
        Start = DateTime.Now,
        End = DateTime.Now.AddDays(1)
    };

    protected override async Task OnInitializedAsync()
    {
        newSchedule.ProjectId = ProjectId;
        _dbContext = await DbContextFactory.CreateDbContextAsync();

        var d = await CarServices.GetCarsAsync();
        cars = d.OrderBy(c => c.Brand).ToList();
    }

    private async Task HandleValidSubmit()
    {
        try
        {
            _dbContext.Schedules.Add(newSchedule);
            await _dbContext.SaveChangesAsync();

            newSchedule = new Schedule()
            {
                Start = DateTime.Now,
                End = DateTime.Now.AddDays(1),
                ProjectId = ProjectId
            };
        }
        catch (Exception f)
        {

            throw f;
        }
    }
}
